{% extends 'home.html' %}

{% block content %}
<h1>Book List</h1>
<ul>
    {% for book in books %}
    <li>
        <a href="{% url 'book_detail' book.pk %}">{{ book.title }}</a>
        <button class="delete-book" data-id="{{ book.pk }}">Delete</button>
    </li>
    {% endfor %}
</ul>

<script>
    const deleteButtons = document.querySelectorAll('.delete-book');

    deleteButtons.forEach(button => {
        button.onclick = async function() {
            const bookId = this.getAttribute('data-id');
            const confirmation = confirm('Are you sure you want to delete this book?');

            if (confirmation) {
                const response = await fetch(`/delete_book/${bookId}/`, {
                    method: 'DELETE',
                    headers: {
                        'X-CSRFToken': '{{ csrf_token }}' 
                    }
                });

                if (response.ok) {
                    alert('Book deleted successfully!');
                    window.location.reload(); 
                } else {
                    alert('Error deleting book.');
                }
            }
        };
    });
</script>

{% endblock %}
